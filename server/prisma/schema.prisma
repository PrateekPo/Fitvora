generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  password           String?
  name               String
  provider           AuthProvider        @default(CREDENTIALS)
  providerId         String?
  dateOfBirth        DateTime?
  gender             Gender?
  currentWeight      Float?
  height             Float?
  goalWeight         Float?
  fitnessGoal        FitnessGoal?
  workoutEnvironment WorkoutEnvironment?
  isOnboarded        Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  photos             Photo[]
  progressLogs       ProgressLog[]
  workoutPlans       WorkoutPlan[]
  workoutSessions    WorkoutSession[]

  @@unique([provider, providerId], map: "unique_provider_account")
  @@index([email])
  @@index([provider, providerId])
}

model Exercise {
  id                String            @id @default(uuid())
  name              String            @unique
  description       String
  muscleGroup       MuscleGroup
  equipment         Equipment
  difficulty        Difficulty
  videoUrl          String?
  imageUrl          String?
  instructions      Json?
  caloriesPerMinute Float?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  exerciseLogs      ExerciseLog[]
  workoutExercises  WorkoutExercise[]

  @@index([muscleGroup])
  @@index([equipment])
  @@index([difficulty])
}

model WorkoutPlan {
  id            String       @id @default(uuid())
  userId        String
  name          String
  description   String?
  goal          FitnessGoal
  duration      Int
  daysPerWeek   Int
  isActive      Boolean      @default(false)
  isAIGenerated Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  workoutDays   WorkoutDay[]
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
}

model WorkoutDay {
  id               String            @id @default(uuid())
  workoutPlanId    String
  dayNumber        Int
  name             String
  isRestDay        Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  workoutPlan      WorkoutPlan       @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)
  workoutExercises WorkoutExercise[]
  workoutSessions  WorkoutSession[]

  @@index([workoutPlanId])
}

model WorkoutExercise {
  id           String     @id @default(uuid())
  workoutDayId String
  exerciseId   String
  orderIndex   Int
  sets         Int
  reps         String
  restSeconds  Int
  notes        String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  exercise     Exercise   @relation(fields: [exerciseId], references: [id])
  workoutDay   WorkoutDay @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)

  @@index([workoutDayId])
  @@index([exerciseId])
}

model WorkoutSession {
  id             String        @id @default(uuid())
  userId         String
  workoutDayId   String?
  startTime      DateTime
  endTime        DateTime?
  totalDuration  Int?
  caloriesBurned Float?
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  exerciseLogs   ExerciseLog[]
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutDay     WorkoutDay?   @relation(fields: [workoutDayId], references: [id])

  @@index([userId])
  @@index([workoutDayId])
  @@index([startTime])
  @@index([userId, startTime])
}

model ExerciseLog {
  id               String         @id @default(uuid())
  workoutSessionId String
  exerciseId       String
  setNumber        Int
  reps             Int
  weight           Float?
  duration         Int?
  completed        Boolean        @default(true)
  createdAt        DateTime       @default(now())
  exercise         Exercise       @relation(fields: [exerciseId], references: [id])
  workoutSession   WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)

  @@index([workoutSessionId])
  @@index([exerciseId])
  @@index([workoutSessionId, exerciseId])
}

model ProgressLog {
  id             String   @id @default(uuid())
  userId         String
  date           DateTime @default(now())
  weight         Float?
  caloriesBurned Float?
  mood           Mood?
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model Photo {
  id        String    @id @default(uuid())
  userId    String
  url       String
  publicId  String
  type      PhotoType
  takenAt   DateTime  @default(now())
  weight    Float?
  notes     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([takenAt])
  @@index([userId, takenAt])
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum FitnessGoal {
  LOSE_WEIGHT
  GAIN_MUSCLE
  MAINTAIN
  IMPROVE_ENDURANCE
}

enum WorkoutEnvironment {
  GYM
  HOME
  BOTH
}

enum AuthProvider {
  CREDENTIALS
  GOOGLE
}

enum MuscleGroup {
  CHEST
  BACK
  LEGS
  SHOULDERS
  ARMS
  CORE
  CARDIO
  FULL_BODY
}

enum Equipment {
  NONE
  DUMBBELLS
  BARBELL
  MACHINE
  RESISTANCE_BAND
  KETTLEBELL
  CABLE
  BENCH
  PULL_UP_BAR
}

enum Difficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum Mood {
  EXCELLENT
  GOOD
  NEUTRAL
  TIRED
  EXHAUSTED
}

enum PhotoType {
  FRONT
  SIDE
  BACK
}
